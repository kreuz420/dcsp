<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Erro 500 - Webhook</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .error-section {
            background: #f8d7da;
            border: 1px solid #dc3545;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .warning-section {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-section {
            background: #d4edda;
            border: 1px solid #28a745;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        .log {
            max-height: 400px;
            overflow-y: auto;
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .error-log {
            background: #000;
            color: #ff6b6b;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® Debug Erro 500 - Webhook Make.com</h1>
        
        <div class="error-section">
            <h2>‚ùå Erro 500 Detectado</h2>
            <p><strong>O que significa:</strong> Erro interno do servidor no Make.com</p>
            <p><strong>Causas comuns:</strong></p>
            <ul>
                <li>Webhook inativo ou desativado</li>
                <li>Cen√°rio com erro de configura√ß√£o</li>
                <li>AI Agent n√£o configurado corretamente</li>
                <li>M√≥dulos faltando ou com erro</li>
                <li>Dados inv√°lidos sendo enviados</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>üîß Testes de Diagn√≥stico</h3>
            <button onclick="testWebhookStatus()">1. Verificar Status do Webhook</button>
            <button onclick="testSimpleRequest()">2. Teste Simples (GET)</button>
            <button onclick="testMinimalData()">3. Teste Dados M√≠nimos</button>
            <button onclick="testFullData()">4. Teste Dados Completos</button>
            <button onclick="testInvalidData()">5. Teste Dados Inv√°lidos</button>
            <button onclick="clearAllLogs()">Limpar Logs</button>
        </div>
        
        <div class="test-section">
            <h3>üìä Log de Testes</h3>
            <div id="debugLog" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>üì§ Dados Enviados</h3>
            <div id="sentData" class="code"></div>
        </div>
        
        <div class="test-section">
            <h3>üì• Resposta Recebida</h3>
            <div id="receivedResponse" class="code"></div>
        </div>
        
        <div class="test-section">
            <h3>üîç An√°lise do Erro</h3>
            <div id="errorAnalysis" class="code"></div>
        </div>
        
        <div class="warning-section">
            <h3>‚ö†Ô∏è Solu√ß√µes para Erro 500</h3>
            <div id="solutions"></div>
        </div>
    </div>

    <script>
        const webhookUrl = 'https://hook.us2.make.com/vd3tce9oprad7vv8eg165gouw7i8j4wn';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : type === 'warning' ? '#ffd43b' : '#74c0fc';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearAllLogs() {
            document.getElementById('debugLog').innerHTML = '';
            document.getElementById('sentData').innerHTML = '';
            document.getElementById('receivedResponse').innerHTML = '';
            document.getElementById('errorAnalysis').innerHTML = '';
            document.getElementById('solutions').innerHTML = '';
        }
        
        function analyzeError(status, responseText) {
            let analysis = `Status: ${status}\n`;
            let solutions = '';
            
            if (status === 500) {
                analysis += '‚ùå Erro 500 - Erro interno do servidor\n\n';
                analysis += 'Poss√≠veis causas:\n';
                analysis += '1. Webhook inativo/desativado\n';
                analysis += '2. Cen√°rio com erro de configura√ß√£o\n';
                analysis += '3. AI Agent n√£o configurado\n';
                analysis += '4. M√≥dulos faltando\n';
                analysis += '5. Dados inv√°lidos\n\n';
                
                solutions = `
                    <h4>üîß Solu√ß√µes para Erro 500:</h4>
                    <ol>
                        <li><strong>Verificar Make.com:</strong>
                            <ul>
                                <li>Acesse make.com e v√° em "Scenarios"</li>
                                <li>Encontre seu cen√°rio e clique nele</li>
                                <li>Verifique se est√° ativo (toggle verde)</li>
                                <li>Clique em "Run once" para testar</li>
                            </ul>
                        </li>
                        <li><strong>Verificar Webhook:</strong>
                            <ul>
                                <li>No cen√°rio, clique no m√≥dulo webhook</li>
                                <li>Verifique se est√° ativo</li>
                                <li>Copie a URL novamente se necess√°rio</li>
                            </ul>
                        </li>
                        <li><strong>Verificar AI Agent:</strong>
                            <ul>
                                <li>Confirme se o AI Agent est√° configurado</li>
                                <li>Verifique se tem cr√©ditos dispon√≠veis</li>
                                <li>Teste o prompt manualmente</li>
                            </ul>
                        </li>
                        <li><strong>Verificar Execu√ß√µes:</strong>
                            <ul>
                                <li>V√° em "Executions" no Make.com</li>
                                <li>Procure por execu√ß√µes com erro</li>
                                <li>Clique na execu√ß√£o para ver detalhes</li>
                            </ul>
                        </li>
                    </ol>
                `;
            } else if (status === 404) {
                analysis += '‚ùå Erro 404 - Webhook n√£o encontrado\n';
                solutions = '<p><strong>Solu√ß√£o:</strong> Verificar se a URL do webhook est√° correta no Make.com</p>';
            } else if (status === 403) {
                analysis += '‚ùå Erro 403 - Acesso negado\n';
                solutions = '<p><strong>Solu√ß√£o:</strong> Verificar permiss√µes do webhook no Make.com</p>';
            } else {
                analysis += `‚ùå Erro ${status} - Erro desconhecido\n`;
                solutions = '<p><strong>Solu√ß√£o:</strong> Verificar logs do Make.com para mais detalhes</p>';
            }
            
            if (responseText) {
                analysis += `\nResposta do servidor:\n${responseText}`;
            }
            
            document.getElementById('errorAnalysis').innerHTML = analysis;
            document.getElementById('solutions').innerHTML = solutions;
        }
        
        async function testWebhookStatus() {
            log('üîç Verificando status do webhook...');
            
            try {
                const response = await fetch(webhookUrl, { 
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                log(`üìä Status: ${response.status} ${response.statusText}`);
                
                if (response.status === 200) {
                    log('‚úÖ Webhook est√° ativo e respondendo', 'success');
                } else if (response.status === 404) {
                    log('‚ùå Webhook n√£o encontrado (404)', 'error');
                } else if (response.status === 500) {
                    log('‚ùå Erro interno do servidor (500)', 'error');
                } else {
                    log(`‚ö†Ô∏è Status inesperado: ${response.status}`, 'warning');
                }
                
                const responseText = await response.text();
                document.getElementById('receivedResponse').innerHTML = responseText || '(Resposta vazia)';
                
            } catch (error) {
                log(`‚ùå Erro de conex√£o: ${error.message}`, 'error');
                document.getElementById('receivedResponse').innerHTML = `Erro: ${error.message}`;
            }
        }
        
        async function testSimpleRequest() {
            log('üîÑ Testando requisi√ß√£o simples...');
            
            const simpleData = { test: true, timestamp: new Date().toISOString() };
            document.getElementById('sentData').innerHTML = JSON.stringify(simpleData, null, 2);
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(simpleData)
                });
                
                log(`üì• Status: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                document.getElementById('receivedResponse').innerHTML = responseText || '(Resposta vazia)';
                
                if (response.status === 500) {
                    log('‚ùå Erro 500 confirmado', 'error');
                    analyzeError(500, responseText);
                } else if (response.ok) {
                    log('‚úÖ Requisi√ß√£o simples funcionou', 'success');
                } else {
                    log(`‚ö†Ô∏è Status inesperado: ${response.status}`, 'warning');
                    analyzeError(response.status, responseText);
                }
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                document.getElementById('receivedResponse').innerHTML = `Erro: ${error.message}`;
            }
        }
        
        async function testMinimalData() {
            log('üîÑ Testando dados m√≠nimos...');
            
            const minimalData = {
                executiveName: 'Teste',
                targetSegment: 'tecnologia',
                centralTheme: 'inovacao',
                contextTrigger: 'Teste m√≠nimo',
                dominantEmotion: 'confianca',
                callToAction: 'contato',
                postType: 'educativo',
                depthLevel: 'basico'
            };
            
            document.getElementById('sentData').innerHTML = JSON.stringify(minimalData, null, 2);
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(minimalData)
                });
                
                log(`üì• Status: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                document.getElementById('receivedResponse').innerHTML = responseText || '(Resposta vazia)';
                
                if (response.status === 500) {
                    log('‚ùå Erro 500 com dados m√≠nimos', 'error');
                    analyzeError(500, responseText);
                } else if (response.ok) {
                    log('‚úÖ Dados m√≠nimos funcionaram', 'success');
                } else {
                    log(`‚ö†Ô∏è Status: ${response.status}`, 'warning');
                    analyzeError(response.status, responseText);
                }
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                document.getElementById('receivedResponse').innerHTML = `Erro: ${error.message}`;
            }
        }
        
        async function testFullData() {
            log('üîÑ Testando dados completos...');
            
            const fullData = {
                executiveName: 'Jo√£o Silva',
                targetSegment: 'tecnologia',
                centralTheme: 'inovacao',
                contextTrigger: 'Nova regulamenta√ß√£o do setor de tecnologia que afeta diretamente nossos clientes e requer adapta√ß√£o imediata dos processos internos.',
                dominantEmotion: 'confianca',
                callToAction: 'contato',
                postType: 'educativo',
                depthLevel: 'intermediario',
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                test: true
            };
            
            document.getElementById('sentData').innerHTML = JSON.stringify(fullData, null, 2);
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(fullData)
                });
                
                log(`üì• Status: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                document.getElementById('receivedResponse').innerHTML = responseText || '(Resposta vazia)';
                
                if (response.status === 500) {
                    log('‚ùå Erro 500 com dados completos', 'error');
                    analyzeError(500, responseText);
                } else if (response.ok) {
                    log('‚úÖ Dados completos funcionaram', 'success');
                } else {
                    log(`‚ö†Ô∏è Status: ${response.status}`, 'warning');
                    analyzeError(response.status, responseText);
                }
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                document.getElementById('receivedResponse').innerHTML = `Erro: ${error.message}`;
            }
        }
        
        async function testInvalidData() {
            log('üîÑ Testando dados inv√°lidos...');
            
            const invalidData = {
                executiveName: '', // Campo vazio
                targetSegment: 'valor_invalido',
                centralTheme: null, // Valor null
                contextTrigger: 'A'.repeat(10000), // Texto muito longo
                dominantEmotion: 'emotion_inexistente',
                callToAction: undefined, // Undefined
                postType: 123, // N√∫mero em vez de string
                depthLevel: {} // Objeto em vez de string
            };
            
            document.getElementById('sentData').innerHTML = JSON.stringify(invalidData, null, 2);
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(invalidData)
                });
                
                log(`üì• Status: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                document.getElementById('receivedResponse').innerHTML = responseText || '(Resposta vazia)';
                
                if (response.status === 500) {
                    log('‚ùå Erro 500 com dados inv√°lidos (esperado)', 'warning');
                    analyzeError(500, responseText);
                } else if (response.ok) {
                    log('‚úÖ Dados inv√°lidos foram aceitos (inesperado)', 'warning');
                } else {
                    log(`‚ö†Ô∏è Status: ${response.status}`, 'warning');
                    analyzeError(response.status, responseText);
                }
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                document.getElementById('receivedResponse').innerHTML = `Erro: ${error.message}`;
            }
        }
        
        // Inicializa√ß√£o
        window.onload = function() {
            log('üöÄ Debug de Erro 500 iniciado');
            log(`üîó Webhook: ${webhookUrl}`);
            log('üí° Execute os testes na ordem para diagnosticar o problema');
        };
    </script>
</body>
</html> 