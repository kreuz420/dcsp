<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Resposta - Agente I.A</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .info { border-color: #17a2b8; background: #d1ecf1; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log {
            max-height: 400px;
            overflow-y: auto;
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .post-preview {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Teste de Resposta do Webhook - Agente I.A</h1>
        <p>Esta p√°gina testa especificamente se a resposta do webhook est√° sendo processada corretamente.</p>
        
        <div class="test-section info">
            <h3>üìã Configura√ß√£o Atual</h3>
            <p><strong>Webhook:</strong> https://hook.us2.make.com/vd3tce9oprad7vv8eg165gouw7i8j4wn</p>
            <p><strong>Status:</strong> <span id="webhookStatus">Verificando...</span></p>
        </div>
        
        <div class="test-section">
            <h3>üß™ Testes de Resposta</h3>
            <button onclick="testRealWebhook()">1. Teste Webhook Real</button>
            <button onclick="testMockResponse()">2. Teste Resposta Simulada</button>
            <button onclick="testResponseProcessing()">3. Teste Processamento</button>
            <button onclick="clearLog()">Limpar Log</button>
        </div>
        
        <div class="test-section">
            <h3>üìä Log de Testes</h3>
            <div id="debugLog" class="log"></div>
        </div>
        
        <div class="test-section">
            <h3>üì§ Dados Enviados</h3>
            <div id="sentData" class="code"></div>
        </div>
        
        <div class="test-section">
            <h3>üì• Resposta Recebida</h3>
            <div id="receivedResponse" class="code"></div>
        </div>
        
        <div class="test-section">
            <h3>üîÑ Dados Processados</h3>
            <div id="processedData" class="code"></div>
        </div>
        
        <div class="test-section">
            <h3>üìù Preview do Post</h3>
            <div id="postPreview" class="post-preview">
                <p>O preview do post aparecer√° aqui ap√≥s o teste.</p>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        const webhookUrl = 'https://hook.us2.make.com/vd3tce9oprad7vv8eg165gouw7i8j4wn';
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
            document.getElementById('sentData').innerHTML = '';
            document.getElementById('receivedResponse').innerHTML = '';
            document.getElementById('processedData').innerHTML = '';
            document.getElementById('postPreview').innerHTML = '<p>O preview do post aparecer√° aqui ap√≥s o teste.</p>';
        }
        
        async function testRealWebhook() {
            log('üîÑ Testando webhook real...');
            
            const testData = {
                executiveName: 'Jo√£o Silva',
                targetSegment: 'tecnologia',
                centralTheme: 'inovacao',
                contextTrigger: 'Teste de resposta do webhook para verificar se os dados est√£o sendo processados corretamente.',
                dominantEmotion: 'confianca',
                callToAction: 'contato',
                postType: 'educativo',
                depthLevel: 'intermediario',
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                test: true
            };
            
            document.getElementById('sentData').innerHTML = JSON.stringify(testData, null, 2);
            
            try {
                log('üì§ Enviando dados...');
                
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                log(`üì• Status da resposta: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                document.getElementById('receivedResponse').innerHTML = responseText;
                
                if (response.ok) {
                    log('‚úÖ Resposta recebida com sucesso!', 'success');
                    
                    // Tentar processar como JSON
                    try {
                        const responseData = JSON.parse(responseText);
                        log('‚úÖ Resposta √© JSON v√°lido', 'success');
                        
                        // Processar resposta usando a fun√ß√£o da landing page
                        const processedData = await processAgentResponse(responseData);
                        document.getElementById('processedData').innerHTML = JSON.stringify(processedData, null, 2);
                        
                        // Exibir preview do post
                        displayPostPreview(processedData);
                        
                    } catch (parseError) {
                        log('‚ö†Ô∏è Resposta n√£o √© JSON v√°lido', 'error');
                        log(`Erro de parsing: ${parseError.message}`, 'error');
                        
                        // Tentar processar como texto simples
                        const processedData = await processAgentResponse(responseText);
                        document.getElementById('processedData').innerHTML = JSON.stringify(processedData, null, 2);
                        displayPostPreview(processedData);
                    }
                    
                } else {
                    log(`‚ùå Erro na resposta: ${response.status}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Erro no teste: ${error.message}`, 'error');
                document.getElementById('receivedResponse').innerHTML = `Erro: ${error.message}`;
            }
        }
        
        async function testMockResponse() {
            log('üîÑ Testando com resposta simulada...');
            
            // Resposta simulada do Make.com
            const mockResponse = {
                success: true,
                post: {
                    title: "Inova√ß√£o no Setor de Tecnologia: Oportunidades e Desafios",
                    content: "üöÄ Jo√£o Silva compartilha insights valiosos sobre inova√ß√£o no mercado de tecnologia.\n\nNova regulamenta√ß√£o do setor de tecnologia que afeta diretamente nossos clientes.\n\nüí° Como especialista em tecnologia, vejo que estamos diante de uma transforma√ß√£o significativa.",
                    hashtags: ["#Tecnologia", "#Inova√ß√£o", "#Mercado"],
                    estimatedReadingTime: "2 min",
                    wordCount: 156
                },
                metadata: {
                    generatedAt: new Date().toISOString(),
                    processingTime: "3.2s",
                    model: "GPT-4",
                    confidence: 0.95
                }
            };
            
            document.getElementById('receivedResponse').innerHTML = JSON.stringify(mockResponse, null, 2);
            
            try {
                const processedData = await processAgentResponse(mockResponse);
                document.getElementById('processedData').innerHTML = JSON.stringify(processedData, null, 2);
                displayPostPreview(processedData);
                log('‚úÖ Resposta simulada processada com sucesso!', 'success');
            } catch (error) {
                log(`‚ùå Erro ao processar resposta simulada: ${error.message}`, 'error');
            }
        }
        
        async function testResponseProcessing() {
            log('üîÑ Testando diferentes formatos de resposta...');
            
            const testFormats = [
                // Formato completo
                {
                    success: true,
                    post: {
                        title: "Post Completo",
                        content: "Conte√∫do do post...",
                        hashtags: ["#Teste"],
                        estimatedReadingTime: "1 min",
                        wordCount: 50
                    }
                },
                // Formato simples
                {
                    success: true,
                    title: "Post Simples",
                    content: "Conte√∫do simples...",
                    hashtags: ["#Simples"]
                },
                // Formato m√≠nimo
                {
                    success: true,
                    content: "Apenas conte√∫do"
                }
            ];
            
            for (let i = 0; i < testFormats.length; i++) {
                log(`üìù Testando formato ${i + 1}...`);
                try {
                    const processedData = await processAgentResponse(testFormats[i]);
                    log(`‚úÖ Formato ${i + 1} processado com sucesso`, 'success');
                } catch (error) {
                    log(`‚ùå Erro no formato ${i + 1}: ${error.message}`, 'error');
                }
            }
        }
        
        // Fun√ß√£o de processamento da landing page (copiada do script.js)
        async function processAgentResponse(responseData) {
            log('üîÑ Processando resposta do agente...');
            
            // Verificar se a resposta tem o formato esperado
            if (responseData && responseData.post) {
                log('‚úÖ Formato completo detectado', 'success');
                return {
                    content: responseData.post,
                    metadata: responseData.metadata || {
                        generatedAt: new Date().toISOString(),
                        processingTime: 'Processado',
                        model: 'AI Agent',
                        confidence: 1.0
                    }
                };
            } else if (responseData && responseData.success) {
                log('‚úÖ Formato alternativo detectado', 'success');
                return {
                    content: {
                        title: responseData.title || 'Post Gerado',
                        content: responseData.content || responseData.text || 'Conte√∫do do post',
                        hashtags: responseData.hashtags || [],
                        estimatedReadingTime: responseData.estimatedReadingTime || '2 min',
                        wordCount: responseData.wordCount || 0
                    },
                    metadata: {
                        generatedAt: new Date().toISOString(),
                        processingTime: 'Processado',
                        model: 'AI Agent',
                        confidence: 1.0
                    }
                };
            } else {
                log('‚ö†Ô∏è Formato n√£o reconhecido, usando fallback', 'error');
                return {
                    content: {
                        title: 'Post Gerado com Sucesso',
                        content: typeof responseData === 'string' ? responseData : JSON.stringify(responseData),
                        hashtags: ['#PostGerado'],
                        estimatedReadingTime: '1 min',
                        wordCount: 50
                    },
                    metadata: {
                        generatedAt: new Date().toISOString(),
                        processingTime: 'Processado',
                        model: 'AI Agent',
                        confidence: 1.0
                    }
                };
            }
        }
        
        function displayPostPreview(postData) {
            const { content, metadata } = postData;
            
            const title = content.title || 'Post Gerado';
            const postContent = content.content || content.text || 'Conte√∫do do post gerado pelo agente de I.A.';
            const hashtags = content.hashtags || [];
            const readingTime = content.estimatedReadingTime || '2 min';
            const wordCount = content.wordCount || postContent.split(' ').length;
            
            document.getElementById('postPreview').innerHTML = `
                <h3>${title}</h3>
                <div style="white-space: pre-line; margin-bottom: 20px; line-height: 1.6;">${postContent}</div>
                
                ${hashtags.length > 0 ? `
                <div style="margin-bottom: 15px;">
                    <strong>Hashtags:</strong> ${hashtags.join(' ')}
                </div>
                ` : ''}
                
                <div style="margin-bottom: 15px;">
                    <strong>Tempo de leitura:</strong> ${readingTime} | 
                    <strong>Palavras:</strong> ${wordCount}
                </div>
                
                ${metadata ? `
                <div style="padding: 10px; background: #e9ecef; border-radius: 5px; font-size: 0.9rem;">
                    <strong>Processamento:</strong> ${metadata.model} | ${metadata.processingTime}
                </div>
                ` : ''}
            `;
            
            log('‚úÖ Preview do post exibido com sucesso!', 'success');
        }
        
        // Inicializa√ß√£o
        window.onload = function() {
            log('üöÄ Teste de resposta iniciado');
            log(`üîó Webhook: ${webhookUrl}`);
            
            // Verificar status do webhook
            fetch(webhookUrl, { method: 'GET' })
                .then(response => {
                    if (response.status === 200) {
                        document.getElementById('webhookStatus').innerHTML = '‚úÖ Ativo';
                        log('‚úÖ Webhook est√° ativo', 'success');
                    } else {
                        document.getElementById('webhookStatus').innerHTML = `‚ö†Ô∏è Status ${response.status}`;
                        log(`‚ö†Ô∏è Webhook status: ${response.status}`, 'error');
                    }
                })
                .catch(error => {
                    document.getElementById('webhookStatus').innerHTML = '‚ùå Erro de conex√£o';
                    log(`‚ùå Erro de conex√£o: ${error.message}`, 'error');
                });
        };
    </script>
</body>
</html> 