<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Erro na Gera√ß√£o de Posts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .info {
            background: #e3f2fd;
            color: #1565c0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        button {
            background: #012774;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0138A7;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1><i class="fas fa-bug"></i> Debug - Erro na Gera√ß√£o de Posts</h1>
    
    <div class="debug-section">
        <h2>1. Verifica√ß√£o de Configura√ß√£o</h2>
        <button onclick="checkConfig()">Verificar Configura√ß√£o</button>
        <div id="configResult"></div>
    </div>

    <div class="debug-section">
        <h2>2. Teste de Conectividade</h2>
        <button onclick="testWebhook()">Testar Webhook</button>
        <div id="webhookResult"></div>
    </div>

    <div class="debug-section">
        <h2>3. Teste Completo do Formul√°rio</h2>
        <form id="testForm">
            <div class="form-group">
                <label>Nome do Executivo:</label>
                <input type="text" id="executiveName" value="Jo√£o Silva" required>
            </div>
            <div class="form-group">
                <label>Segmento:</label>
                <select id="targetSegment" required>
                    <option value="">Selecione...</option>
                    <option value="Tecnologia" selected>Tecnologia</option>
                    <option value="Sa√∫de">Sa√∫de</option>
                    <option value="Finan√ßas">Finan√ßas</option>
                </select>
            </div>
            <div class="form-group">
                <label>Tema Central:</label>
                <select id="centralTheme" required>
                    <option value="">Selecione...</option>
                    <option value="Inova√ß√£o" selected>Inova√ß√£o</option>
                    <option value="Tend√™ncias">Tend√™ncias</option>
                </select>
            </div>
            <div class="form-group">
                <label>Contexto:</label>
                <textarea id="contextTrigger" rows="3" required>Nova tecnologia disruptiva no mercado</textarea>
            </div>
            <div class="form-group">
                <label>Emo√ß√£o:</label>
                <select id="dominantEmotion" required>
                    <option value="">Selecione...</option>
                    <option value="Confian√ßa" selected>Confian√ßa</option>
                    <option value="Entusiasmo">Entusiasmo</option>
                </select>
            </div>
            <div class="form-group">
                <label>Call to Action:</label>
                <select id="callToAction" required>
                    <option value="">Selecione...</option>
                    <option value="Entre em Contato" selected>Entre em Contato</option>
                    <option value="Agende uma Reuni√£o">Agende uma Reuni√£o</option>
                </select>
            </div>
            <div class="form-group">
                <label>Tipo de Post:</label>
                <select id="postType" required>
                    <option value="">Selecione...</option>
                    <option value="Educativo" selected>Educativo</option>
                    <option value="Promocional">Promocional</option>
                </select>
            </div>
            <div class="form-group">
                <label>N√≠vel:</label>
                <select id="depthLevel" required>
                    <option value="">Selecione...</option>
                    <option value="B√°sico" selected>B√°sico</option>
                    <option value="Intermedi√°rio">Intermedi√°rio</option>
                </select>
            </div>
            <button type="submit">Testar Gera√ß√£o Completa</button>
        </form>
        <div id="formResult"></div>
    </div>

    <div class="debug-section">
        <h2>4. Logs de Debug</h2>
        <button onclick="clearLogs()">Limpar Logs</button>
        <div id="debugLogs" class="log"></div>
    </div>

    <script src="config.js"></script>
    <script>
        let debugLogs = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            debugLogs.push(logEntry);
            
            const logsDiv = document.getElementById('debugLogs');
            logsDiv.textContent = debugLogs.join('\n');
            logsDiv.scrollTop = logsDiv.scrollHeight;
            
            console.log(logEntry);
        }

        function clearLogs() {
            debugLogs = [];
            document.getElementById('debugLogs').textContent = '';
        }

        function checkConfig() {
            log('Iniciando verifica√ß√£o de configura√ß√£o...');
            
            const resultDiv = document.getElementById('configResult');
            let html = '';
            
            try {
                // Verificar se config.js foi carregado
                if (typeof LANDING_PAGE_CONFIG === 'undefined') {
                    throw new Error('LANDING_PAGE_CONFIG n√£o est√° definido');
                }
                
                html += '<div class="success">‚úÖ Configura√ß√£o carregada com sucesso</div>';
                
                // Verificar webhook URL
                if (!LANDING_PAGE_CONFIG.webhookUrl) {
                    throw new Error('URL do webhook n√£o configurada');
                }
                
                html += `<div class="info">üåê Webhook URL: ${LANDING_PAGE_CONFIG.webhookUrl}</div>`;
                
                // Verificar op√ß√µes
                if (!LANDING_PAGE_CONFIG.options) {
                    throw new Error('Op√ß√µes n√£o configuradas');
                }
                
                html += '<div class="success">‚úÖ Op√ß√µes configuradas</div>';
                
                // Verificar valida√ß√£o
                if (!LANDING_PAGE_CONFIG.validation) {
                    throw new Error('Valida√ß√£o n√£o configurada');
                }
                
                html += '<div class="success">‚úÖ Valida√ß√£o configurada</div>';
                
                log('Configura√ß√£o verificada com sucesso');
                
            } catch (error) {
                html += `<div class="error">‚ùå Erro: ${error.message}</div>`;
                log(`Erro na configura√ß√£o: ${error.message}`, 'error');
            }
            
            resultDiv.innerHTML = html;
        }

        async function testWebhook() {
            log('Iniciando teste do webhook...');
            
            const resultDiv = document.getElementById('webhookResult');
            let html = '';
            
            try {
                const testData = {
                    executiveName: 'Teste Debug',
                    targetSegment: 'Tecnologia',
                    centralTheme: 'Inova√ß√£o',
                    contextTrigger: 'Teste de conectividade',
                    dominantEmotion: 'Confian√ßa',
                    callToAction: 'Entre em Contato',
                    postType: 'Educativo',
                    depthLevel: 'B√°sico'
                };
                
                log(`Enviando dados de teste: ${JSON.stringify(testData)}`);
                
                const response = await fetch(LANDING_PAGE_CONFIG.webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                log(`Status da resposta: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    // CORRE√á√ÉO: Ler o corpo da resposta apenas UMA vez
                    const responseText = await response.text();
                    log(`Resposta recebida: ${responseText.substring(0, 200)}...`);
                    
                    html += '<div class="success">‚úÖ Webhook funcionando</div>';
                    html += `<div class="info">üì• Status: ${response.status}</div>`;
                    html += `<div class="info">üìÑ Resposta: ${responseText.substring(0, 100)}...</div>`;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                html += `<div class="error">‚ùå Erro no webhook: ${error.message}</div>`;
                log(`Erro no webhook: ${error.message}`, 'error');
            }
            
            resultDiv.innerHTML = html;
        }

        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            log('Iniciando teste completo do formul√°rio...');
            
            const resultDiv = document.getElementById('formResult');
            let html = '';
            
            try {
                // Coletar dados do formul√°rio
                const formData = {
                    executiveName: document.getElementById('executiveName').value,
                    targetSegment: document.getElementById('targetSegment').value,
                    centralTheme: document.getElementById('centralTheme').value,
                    contextTrigger: document.getElementById('contextTrigger').value,
                    dominantEmotion: document.getElementById('dominantEmotion').value,
                    callToAction: document.getElementById('callToAction').value,
                    postType: document.getElementById('postType').value,
                    depthLevel: document.getElementById('depthLevel').value
                };
                
                log(`Dados do formul√°rio: ${JSON.stringify(formData)}`);
                
                // Validar campos obrigat√≥rios
                const requiredFields = LANDING_PAGE_CONFIG.validation.required;
                for (const field of requiredFields) {
                    if (!formData[field] || formData[field].trim() === '') {
                        throw new Error(`Campo obrigat√≥rio n√£o preenchido: ${field}`);
                    }
                }
                
                log('Valida√ß√£o do formul√°rio aprovada');
                
                // Enviar para webhook
                const response = await fetch(LANDING_PAGE_CONFIG.webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                log(`Status da resposta: ${response.status}`);
                
                if (response.ok) {
                    // CORRE√á√ÉO: Ler o corpo da resposta apenas UMA vez
                    const responseText = await response.text();
                    let responseData;
                    
                    try {
                        responseData = JSON.parse(responseText);
                        log('Resposta JSON recebida');
                    } catch (parseError) {
                        responseData = responseText;
                        log('Resposta como texto recebida');
                    }
                    
                    log(`Conte√∫do da resposta: ${JSON.stringify(responseData).substring(0, 200)}...`);
                    
                    html += '<div class="success">‚úÖ Post gerado com sucesso!</div>';
                    html += `<div class="info">üìÑ Conte√∫do: ${JSON.stringify(responseData).substring(0, 100)}...</div>`;
                    
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                html += `<div class="error">‚ùå Erro: ${error.message}</div>`;
                log(`Erro no teste: ${error.message}`, 'error');
            }
            
            resultDiv.innerHTML = html;
        });

        // Auto-executar verifica√ß√£o de configura√ß√£o
        window.addEventListener('load', function() {
            log('P√°gina de debug carregada');
            checkConfig();
        });
    </script>
</body>
</html> 